<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Widgets Preview (Demo)</title>
    <style>
      :root { --bg:#f3f4f6; --card:#fff; --muted:#6b7280; --border:#e5e7eb; }
      body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color:#111827; }
      .wrap { max-width: 1100px; margin: 0 auto; padding: 18px 16px 28px; }
      .topbar { display:flex; align-items:center; justify-content:space-between; gap:12px; }
      .title { font-size: 18px; font-weight: 700; margin: 0; }
      .sub { margin: 6px 0 0; color: var(--muted); font-size: 13px; }
      .pill { display:inline-flex; gap:10px; align-items:center; padding: 6px 10px; border:1px solid var(--border); border-radius: 999px; background: rgba(255,255,255,.7); }
      .btn { border: 1px solid var(--border); background:#fff; border-radius: 12px; padding: 8px 12px; cursor:pointer; font: inherit; }
      .btn:hover { filter: brightness(0.98); }
      .grid { margin-top: 14px; display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 12px; }
      @media (max-width: 820px){ .grid{ grid-template-columns: 1fr; } }
      .card { background: var(--card); border:1px solid var(--border); border-radius: 16px; padding: 12px; }
      .card h3 { margin: 0 0 6px; font-size: 14px; }
      .muted { color: var(--muted); font-size: 12px; }
      .slot { margin-top: 10px; padding: 10px; border: 1px dashed var(--border); border-radius: 14px; background: #fafafa; }
      code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; }
      .warn { margin-top: 10px; background: #fff7ed; border: 1px solid #fed7aa; color:#9a3412; padding: 10px 12px; border-radius: 14px; font-size: 13px; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="topbar">
        <div>
          <h1 class="title">Preview: Widgets (Demo mode)</h1>
          <p class="sub">
            Ця сторінка призначена для демонстрації. Натискання “Submit” не відправляє дані на сервер і не створює записів у БД.
          </p>
        </div>
        <div class="pill">
          <span class="muted">Project:</span>
          <strong id="p-slug">—</strong>
        </div>
      </div>

      <div id="missing" class="warn" style="display:none;">
        Не вистачає параметрів <code>projectSlug</code> або <code>projectKey</code> у URL. Відкрийте Preview з адмінки (Integration → Preview).
      </div>

      <div class="grid">
        <div class="card">
          <h3>Lead</h3>
          <div class="muted">Кнопка та модалка для “Залишити запит”.</div>
          <div class="slot" id="slot-lead"></div>
        </div>
        <div class="card">
          <h3>Donation</h3>
          <div class="muted">Кнопка та модалка для пожертви.</div>
          <div class="slot" id="slot-donation"></div>
        </div>
        <div class="card">
          <h3>Booking</h3>
          <div class="muted">Кнопка та модалка для бронювання.</div>
          <div class="slot" id="slot-booking"></div>
        </div>
        <div class="card">
          <h3>Feedback</h3>
          <div class="muted">Кнопка та модалка для відгуку.</div>
          <div class="slot" id="slot-feedback"></div>
        </div>
      </div>

      <p class="sub" style="margin-top:14px;">
        Порада: відкрийте DevTools → Console, щоб бачити payload у демо-режимі (лог <code>[mini-crm][demo]</code>).
      </p>
    </div>

    <script>
      (function(){
        var params = new URLSearchParams(window.location.search);
        var projectSlug = params.get('projectSlug') || '';
        var projectKey = params.get('projectKey') || '';
        var apiBase = params.get('apiBase') || window.location.origin;

        var slugEl = document.getElementById('p-slug');
        if (slugEl) slugEl.textContent = projectSlug || '—';

        var missing = document.getElementById('missing');
        if (!projectSlug || !projectKey) {
          if (missing) missing.style.display = '';
          return;
        }

        function mount(slotId, formKey, buttonText){
          var slot = document.getElementById(slotId);
          if (!slot) return;
          // Use widget.js directly (supports multiple widgets on one page).
          var s = document.createElement('script');
          s.src = apiBase.replace(/\/$/, '') + '/widget/widget.js';
          s.dataset.projectSlug = projectSlug;
          s.dataset.projectKey = projectKey;
          s.dataset.form = formKey;
          s.dataset.demo = '1';
          if (buttonText) s.dataset.buttonText = buttonText;
          slot.appendChild(s);
        }

        mount('slot-lead', 'lead', 'Залишити запит');
        mount('slot-donation', 'donation', 'Пожертвувати');
        mount('slot-booking', 'booking', 'Записатися');
        mount('slot-feedback', 'feedback', 'Залишити відгук');
      })();
    </script>
  </body>
</html>
